unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix
bind-key a send-prefix

set-window-option -g automatic-rename on

# Format window names with process name and current directory path
set-window-option -g automatic-rename-format '#{pane_current_command} #{b:pane_current_path}'

# Set UTF-8 locale for Unicode glyph support (WSL only has C.utf8, not en_US.UTF-8)
if-shell "locale -a | grep -q 'C.utf8'" "set-environment -g LANG C.utf8 ; set-environment -g LC_ALL C.utf8"

# Enable mouse control (clickable windows, panes, resizable panes)
set -g mouse on
set -g default-terminal "screen-256color"
set -ga terminal-overrides "*:Tc"
set -as terminal-features "*:RGB"

set -g base-index 0
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes using vim-style keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes using vim-style keys (repeatable with -r flag)
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# Ensure detach key is set correctly
unbind-key d
bind-key d detach-client

# Enable vi-mode for copy mode
set-window-option -g mode-keys vi

# Vi copy mode extensions
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi H send-keys -X history-top
bind -T copy-mode-vi L send-keys -X history-bottom
bind -T copy-mode-vi g send-keys -X history-top
bind -T copy-mode-vi G send-keys -X history-bottom

# URL view (requires urlscan - install via package manager)
if-shell "command -v urlscan &> /dev/null" "bind-key u run-shell \"tmux capture-pane -J -p | urlscan\""

# Plugins
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'fabioluciano/tmux-powerkit'

# tmux-yank settings
set -g @yank_action 'copy-pipe'
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# Initialize TMUX Plugin Manager
run '~/.tmux/plugins/tpm/tpm'
